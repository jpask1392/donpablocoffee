<div class="container">
  {% if section.settings.title %}
    <div class="row">
      <div class="col">
        <h2 class="section-title has-coffee-bean text-center mb-5">{{ section.settings.title }}</h2>
      </div>
    </div>
  {% endif %}
  <div class="row mb-n5">
    {% for block in section.blocks %}
    {% assign videoURL = block.settings.video_url %}

    {% comment %} determine if youtube or vimeo {% endcomment %}
    {% if videoURL contains 'vimeo' %}
      {% assign videoID = videoURL | slice:31, 100 %}
      <script>
        // vimeo requires an api call to 
        // get the videos thumbnail image
        $.ajax({
          url: 'https://vimeo.com/api/v2/video/{{videoID}}.json',
          success: function (data) {
            const imageNode = `<img src="${data[0].thumbnail_medium}"></img>`;
            $('#thumbnailID_{{videoID}}').html(imageNode);
            $('.thumbnail-play-btn').show();
          }
        });
      </script>
    {% else %}
      {% assign videoID = videoURL | slice:17, 100 %}
    {% endif %}

    <div class="col-md-4 col-lg-3  mb-5 d-flex flex-column">
      <div 
        class="video__thumbnail" 
        data-toggle="modal" 
        data-videoID={{videoID}}
        data-videoURL={{videoURL}}
      >
        <span class="thumbnail-play-btn" style="display: none;">
          <svg width="65" height="65" viewBox="0 0 65 65" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M32.5 4.81264e-09C14.5784 2.15879e-09 -1.03672e-08 14.5798 -2.31097e-08 32.5C-3.58522e-08 50.4202 14.5784 65 32.5 65C50.4216 65 65 50.4202 65 32.5C65 14.5798 50.4216 7.46649e-09 32.5 4.81264e-09ZM45.4201 33.6386L26.4619 45.8261C26.2397 45.9702 25.9831 46.0417 25.7292 46.0417C25.507 46.0417 25.2822 45.9861 25.0812 45.8764C24.6448 45.6384 24.375 45.1834 24.375 44.6875L24.375 20.3125C24.375 19.8166 24.6448 19.3616 25.0812 19.1236C25.5097 18.8882 26.0466 18.9027 26.4619 19.1739L45.4201 31.3614C45.8063 31.6099 46.0417 32.0398 46.0417 32.5C46.0417 32.9602 45.8063 33.3899 45.4201 33.6386Z"/>
          </svg>
          </span>
        <div id="thumbnailID_{{videoID}}">
          {% if videoURL contains 'vimeo' %}
            <div class="spinner-wrapper">
              <svg class="spinner" width="65px" height="65px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"><circle class="circle" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg>
            </div>
          {% else %}
            <img src="https://img.youtube.com/vi/{{videoID}}/sddefault.jpg">
          {% endif %}
        </div>
      </div>
      <div class="video__title">
        {{block.settings.videoTitle}}
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="videoModal" tabindex="-1" role="dialog" aria-labelledby="videoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <iframe 
        id="videoIframe"
        src=""
        width="800" height="500"
        frameborder="0"
        webkitallowfullscreen
        mozallowfullscreen
        allowfullscreen
      >
      </iframe>
    </div>
  </div>
</div>

<script defer src="{{ 'z__jsMedia.js' | asset_url }}"></script>

{% schema %}
{
  "name": "Media",
  "class": "media-section py-5 has-coffee-background",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title" 
    }
  ],
  "blocks": [
    {
      "type": "video",
      "name": "Video",
      "settings": [
        {
          "id": "video_url",
          "type": "video_url",
          "label": "Video URL",
          "accept": ["youtube", "vimeo"]
        },
        {
          "id": "videoTitle",
          "type": "text",
          "label": "Video Title"
        }
      ]
    }
  ]
}
{% endschema %}